openapi: 3.0.3
info:
  title: Med Tracker API
  version: 0.1.0
servers:
  - url: /api
paths:
  /health:
    get:
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
  /auth/register:
    post:
      summary: Register user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
            examples:
              default:
                value:
                  name: "Jane Doe"
                  email: "jane@example.com"
                  password: "secret123"
      responses:
        "201":
          description: Registered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
              examples:
                default:
                  value:
                    token: "1|example_token"
        "422":
          $ref: "#/components/responses/ValidationError"
  /auth/login:
    post:
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
            examples:
              default:
                value:
                  email: "jane@example.com"
                  password: "secret123"
      responses:
        "200":
          description: Logged in
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
              examples:
                default:
                  value:
                    token: "1|example_token"
        "422":
          $ref: "#/components/responses/ValidationError"
  /auth/logout:
    post:
      summary: Logout user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Logged out
        "401":
          $ref: "#/components/responses/Unauthorized"
  /user/profile:
    get:
      summary: Get user profile
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/Unauthorized"
    put:
      summary: Update user profile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserProfileUpdateRequest"
            examples:
              default:
                value:
                  timezone: "America/Sao_Paulo"
                  language: "pt-BR"
      responses:
        "200":
          description: Updated profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
              examples:
                default:
                  value:
                    id: 1
                    name: "Jane Doe"
                    email: "jane@example.com"
                    timezone: "America/Sao_Paulo"
                    language: "pt-BR"
                    created_at: "2025-12-26T08:00:00Z"
                    updated_at: "2025-12-26T08:00:00Z"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"
  /medications:
    get:
      summary: List medications
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/IncludeInactive"
      responses:
        "200":
          description: Medications list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Medication"
        "401":
          $ref: "#/components/responses/Unauthorized"
    post:
      summary: Create medication
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MedicationCreateRequest"
            examples:
              default:
                value:
                  name: "Vitamin D"
                  dosage: "1 pill"
                  instructions: "After breakfast"
                  is_active: true
      responses:
        "201":
          description: Created medication
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Medication"
              examples:
                default:
                  value:
                    id: 10
                    user_id: 1
                    name: "Vitamin D"
                    dosage: "1 pill"
                    instructions: "After breakfast"
                    is_active: true
                    created_at: "2025-12-26T08:00:00Z"
                    updated_at: "2025-12-26T08:00:00Z"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"
  /medications/{medication}:
    get:
      summary: Get medication
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/MedicationId"
      responses:
        "200":
          description: Medication
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Medication"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      summary: Update medication
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/MedicationId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MedicationUpdateRequest"
      responses:
        "200":
          description: Updated medication
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Medication"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/ValidationError"
    delete:
      summary: Deactivate medication
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/MedicationId"
      responses:
        "200":
          description: Deactivated medication
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
  /medications/{medication}/schedules:
    get:
      summary: List schedules for medication
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/MedicationId"
        - $ref: "#/components/parameters/IncludeInactive"
      responses:
        "200":
          description: Schedules list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Schedule"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
  /schedules:
    post:
      summary: Create schedule
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScheduleCreateRequest"
            examples:
              daily:
                value:
                  medication_id: 10
                  recurrence_type: "daily"
                  times: ["08:00", "20:00"]
                  is_active: true
              weekly:
                value:
                  medication_id: 10
                  recurrence_type: "weekly"
                  times: ["09:00"]
                  weekdays: ["mon", "wed", "fri"]
                  is_active: true
              interval:
                value:
                  medication_id: 10
                  recurrence_type: "interval"
                  interval_hours: 8
                  is_active: true
      responses:
        "201":
          description: Created schedule
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Schedule"
              examples:
                default:
                  value:
                    id: 100
                    medication_id: 10
                    recurrence_type: "daily"
                    times: ["08:00", "20:00"]
                    weekdays: null
                    interval_hours: null
                    is_active: true
                    created_at: "2025-12-26T08:00:00Z"
                    updated_at: "2025-12-26T08:00:00Z"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"
  /schedules/{schedule}:
    get:
      summary: Get schedule
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ScheduleId"
      responses:
        "200":
          description: Schedule
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Schedule"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      summary: Update schedule
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ScheduleId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScheduleUpdateRequest"
      responses:
        "200":
          description: Updated schedule
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Schedule"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/ValidationError"
    delete:
      summary: Deactivate schedule
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ScheduleId"
      responses:
        "200":
          description: Deactivated schedule
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
  /intakes:
    get:
      summary: List intakes
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Intakes list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Intake"
        "401":
          $ref: "#/components/responses/Unauthorized"
    post:
      summary: Create intake
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IntakeCreateRequest"
            examples:
              taken:
                value:
                  schedule_id: 100
                  status: "taken"
                  taken_at: "2025-12-26T08:05:00Z"
              skipped:
                value:
                  schedule_id: 100
                  status: "skipped"
                  taken_at: "2025-12-26T08:05:00Z"
      responses:
        "201":
          description: Created intake
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Intake"
              examples:
                default:
                  value:
                    id: 500
                    schedule_id: 100
                    medication_id: 10
                    user_id: 1
                    status: "taken"
                    taken_at: "2025-12-26T08:05:00Z"
                    created_at: "2025-12-26T08:05:00Z"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"
  /reports/adherence/daily:
    get:
      summary: Daily adherence report
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Adherence report
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdherenceReport"
        "401":
          $ref: "#/components/responses/Unauthorized"
  /reports/adherence:
    get:
      summary: Adherence summary
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: to
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: medication_id
          required: false
          schema:
            type: integer
        - in: query
          name: schedule_id
          required: false
          schema:
            type: integer
      responses:
        "200":
          description: Adherence summary
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdherenceSummary"
              examples:
                default:
                  value:
                    period:
                      from: "2025-12-26T00:00:00Z"
                      to: "2025-12-26T23:59:59Z"
                    summary:
                      expected: 2
                      taken: 1
                      skipped: 0
                      missed: 1
                      adherence_rate: 0.5
                    by_medication:
                      - medication_id: 10
                        medication_name: "Vitamin D"
                        expected: 2
                        taken: 1
                        skipped: 0
                        missed: 1
                        adherence_rate: 0.5
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"
  /reports/adherence/medications:
    get:
      summary: Medication adherence breakdown
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: to
          required: true
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Medication adherence breakdown
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AdherenceMedicationBreakdown"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"
  /reports/adherence/schedules:
    get:
      summary: Schedule adherence breakdown
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: to
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: medication_id
          required: false
          schema:
            type: integer
      responses:
        "200":
          description: Schedule adherence breakdown
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AdherenceScheduleBreakdown"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"
  /reports/adherence/weekly:
    get:
      summary: Weekly adherence report
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Adherence report
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdherenceReport"
        "401":
          $ref: "#/components/responses/Unauthorized"
  /reports/adherence/monthly:
    get:
      summary: Monthly adherence report
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Adherence report
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdherenceReport"
        "401":
          $ref: "#/components/responses/Unauthorized"
  /reports/intake-timeline:
    get:
      summary: Intake timeline
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: to
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: schedule_id
          required: false
          schema:
            type: integer
        - in: query
          name: medication_id
          required: false
          schema:
            type: integer
      responses:
        "200":
          description: Intake timeline
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IntakeTimelineItem"
              examples:
                default:
                  value:
                    - scheduled_at: "2025-12-26T08:00:00Z"
                      status: "missed"
                      medication_id: 10
                      schedule_id: 100
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
  parameters:
    MedicationId:
      name: medication
      in: path
      required: true
      schema:
        type: integer
    ScheduleId:
      name: schedule
      in: path
      required: true
      schema:
        type: integer
    IncludeInactive:
      name: include_inactive
      in: query
      required: false
      schema:
        type: boolean
  responses:
    Unauthorized:
      description: Unauthenticated
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            message: "Unauthenticated."
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            message: "Not Found."
    ValidationError:
      description: Validation Error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ValidationErrorResponse"
          example:
            message: "Validation failed."
            errors:
              email:
                - "The email field is required."
    ServerError:
      description: Server Error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            message: "Server Error."
  schemas:
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
    ValidationErrorResponse:
      type: object
      properties:
        message:
          type: string
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
    TokenResponse:
      type: object
      properties:
        token:
          type: string
      example:
        token: "1|example_token"
    RegisterRequest:
      type: object
      required: [name, email, password]
      properties:
        name:
          type: string
        email:
          type: string
        password:
          type: string
      example:
        name: "Jane Doe"
        email: "jane@example.com"
        password: "secret123"
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
        password:
          type: string
      example:
        email: "jane@example.com"
        password: "secret123"
    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
        timezone:
          type: string
          nullable: true
        language:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      example:
        id: 1
        name: "Jane Doe"
        email: "jane@example.com"
        timezone: "UTC"
        language: "en"
        created_at: "2025-12-26T08:00:00Z"
        updated_at: "2025-12-26T08:00:00Z"
    UserProfileUpdateRequest:
      type: object
      required: [timezone, language]
      properties:
        timezone:
          type: string
        language:
          type: string
          enum: [en, pt-BR]
      example:
        timezone: "America/Sao_Paulo"
        language: "pt-BR"
    Medication:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        name:
          type: string
        dosage:
          type: string
        instructions:
          type: string
          nullable: true
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      example:
        id: 10
        user_id: 1
        name: "Vitamin D"
        dosage: "1 pill"
        instructions: "After breakfast"
        is_active: true
        created_at: "2025-12-26T08:00:00Z"
        updated_at: "2025-12-26T08:00:00Z"
    MedicationCreateRequest:
      type: object
      required: [name, dosage]
      properties:
        name:
          type: string
        dosage:
          type: string
        instructions:
          type: string
          nullable: true
        is_active:
          type: boolean
      example:
        name: "Vitamin D"
        dosage: "1 pill"
        instructions: "After breakfast"
        is_active: true
    MedicationUpdateRequest:
      type: object
      properties:
        name:
          type: string
        dosage:
          type: string
        instructions:
          type: string
          nullable: true
        is_active:
          type: boolean
      example:
        name: "Vitamin D"
        dosage: "2 pills"
        instructions: "After breakfast"
        is_active: true
    Schedule:
      type: object
      properties:
        id:
          type: integer
        medication_id:
          type: integer
        recurrence_type:
          type: string
          enum: [daily, weekly, interval]
        times:
          type: array
          items:
            type: string
        weekdays:
          type: array
          items:
            type: string
          nullable: true
        interval_hours:
          type: integer
          nullable: true
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      example:
        id: 100
        medication_id: 10
        recurrence_type: "daily"
        times: ["08:00", "20:00"]
        weekdays: null
        interval_hours: null
        is_active: true
        created_at: "2025-12-26T08:00:00Z"
        updated_at: "2025-12-26T08:00:00Z"
    ScheduleCreateRequest:
      type: object
      required: [medication_id, recurrence_type]
      properties:
        medication_id:
          type: integer
        recurrence_type:
          type: string
          enum: [daily, weekly, interval]
        times:
          type: array
          items:
            type: string
        weekdays:
          type: array
          items:
            type: string
          nullable: true
        interval_hours:
          type: integer
          nullable: true
        is_active:
          type: boolean
      example:
        medication_id: 10
        recurrence_type: "daily"
        times: ["08:00", "20:00"]
        weekdays: null
        interval_hours: null
        is_active: true
    ScheduleUpdateRequest:
      type: object
      properties:
        recurrence_type:
          type: string
          enum: [daily, weekly, interval]
        times:
          type: array
          items:
            type: string
        weekdays:
          type: array
          items:
            type: string
          nullable: true
        interval_hours:
          type: integer
          nullable: true
        is_active:
          type: boolean
      example:
        recurrence_type: "weekly"
        times: ["09:00"]
        weekdays: ["mon", "wed", "fri"]
        interval_hours: null
        is_active: true
    Intake:
      type: object
      properties:
        id:
          type: integer
        schedule_id:
          type: integer
        medication_id:
          type: integer
        user_id:
          type: integer
        status:
          type: string
          enum: [taken, skipped]
        taken_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
      example:
        id: 500
        schedule_id: 100
        medication_id: 10
        user_id: 1
        status: "taken"
        taken_at: "2025-12-26T08:05:00Z"
        created_at: "2025-12-26T08:05:00Z"
    IntakeCreateRequest:
      type: object
      required: [schedule_id, status]
      properties:
        schedule_id:
          type: integer
        status:
          type: string
          enum: [taken, skipped]
        taken_at:
          type: string
          format: date-time
      example:
        schedule_id: 100
        status: "taken"
        taken_at: "2025-12-26T08:05:00Z"
    AdherenceReport:
      type: object
      properties:
        period:
          type: string
          enum: [daily, weekly, monthly]
        period_start:
          type: string
          format: date-time
        period_end:
          type: string
          format: date-time
        expected:
          type: integer
        taken:
          type: integer
        skipped:
          type: integer
        missed:
          type: integer
        adherence:
          type: number
          format: float
      example:
        period: "daily"
        period_start: "2025-12-26T00:00:00Z"
        period_end: "2025-12-26T23:59:59Z"
        expected: 2
        taken: 1
        skipped: 1
        missed: 0
        adherence: 0.5
    AdherenceSummary:
      oneOf:
        - type: object
          properties:
            period:
              type: object
              properties:
                from:
                  type: string
                  format: date-time
                to:
                  type: string
                  format: date-time
            summary:
              type: object
              properties:
                expected:
                  type: integer
                taken:
                  type: integer
                skipped:
                  type: integer
                missed:
                  type: integer
                adherence_rate:
                  type: number
                  format: float
        - type: object
          properties:
            period:
              type: object
              properties:
                from:
                  type: string
                  format: date-time
                to:
                  type: string
                  format: date-time
            summary:
              type: object
              properties:
                expected:
                  type: integer
                taken:
                  type: integer
                skipped:
                  type: integer
                missed:
                  type: integer
                adherence_rate:
                  type: number
                  format: float
            by_medication:
              type: array
              items:
                $ref: "#/components/schemas/AdherenceMedicationBreakdown"
      example:
        period:
          from: "2025-12-26T00:00:00Z"
          to: "2025-12-26T23:59:59Z"
        summary:
          expected: 2
          taken: 1
          skipped: 0
          missed: 1
          adherence_rate: 0.5
        by_medication:
          - medication_id: 10
            medication_name: "Vitamin D"
            expected: 2
            taken: 1
            skipped: 0
            missed: 1
            adherence_rate: 0.5
    AdherenceMedicationBreakdown:
      type: object
      properties:
        medication_id:
          type: integer
        medication_name:
          type: string
        expected:
          type: integer
        taken:
          type: integer
        skipped:
          type: integer
        missed:
          type: integer
        adherence_rate:
          type: number
          format: float
      example:
        medication_id: 10
        medication_name: "Vitamin D"
        expected: 2
        taken: 1
        skipped: 0
        missed: 1
        adherence_rate: 0.5
    AdherenceScheduleBreakdown:
      type: object
      properties:
        schedule_id:
          type: integer
        medication_id:
          type: integer
        expected:
          type: integer
        taken:
          type: integer
        skipped:
          type: integer
        missed:
          type: integer
        adherence_rate:
          type: number
          format: float
      example:
        schedule_id: 100
        medication_id: 10
        expected: 2
        taken: 1
        skipped: 0
        missed: 1
        adherence_rate: 0.5
    IntakeTimelineItem:
      type: object
      properties:
        scheduled_at:
          type: string
          format: date-time
        status:
          type: string
          enum: [taken, skipped, missed, pending]
        medication_id:
          type: integer
        schedule_id:
          type: integer
      example:
        scheduled_at: "2025-12-26T08:00:00Z"
        status: "missed"
        medication_id: 10
        schedule_id: 100
