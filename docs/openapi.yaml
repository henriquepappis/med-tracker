openapi: 3.0.3
info:
  title: Med Tracker API
  version: 0.1.0
servers:
  - url: /api
paths:
  /health:
    get:
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
  /auth/register:
    post:
      summary: Register user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: Registered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
  /auth/login:
    post:
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Logged in
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
  /auth/logout:
    post:
      summary: Logout user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Logged out
  /user/profile:
    get:
      summary: Get user profile
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
    put:
      summary: Update user profile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserProfileUpdateRequest"
      responses:
        "200":
          description: Updated profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
  /medications:
    get:
      summary: List medications
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/IncludeInactive"
      responses:
        "200":
          description: Medications list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Medication"
    post:
      summary: Create medication
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MedicationCreateRequest"
      responses:
        "201":
          description: Created medication
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Medication"
  /medications/{medication}:
    get:
      summary: Get medication
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/MedicationId"
      responses:
        "200":
          description: Medication
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Medication"
        "404":
          description: Not Found
    put:
      summary: Update medication
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/MedicationId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MedicationUpdateRequest"
      responses:
        "200":
          description: Updated medication
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Medication"
        "404":
          description: Not Found
    delete:
      summary: Deactivate medication
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/MedicationId"
      responses:
        "200":
          description: Deactivated medication
        "404":
          description: Not Found
  /schedules:
    get:
      summary: List schedules
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/IncludeInactive"
      responses:
        "200":
          description: Schedules list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Schedule"
    post:
      summary: Create schedule
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScheduleCreateRequest"
      responses:
        "201":
          description: Created schedule
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Schedule"
  /schedules/{schedule}:
    get:
      summary: Get schedule
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ScheduleId"
      responses:
        "200":
          description: Schedule
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Schedule"
        "404":
          description: Not Found
    put:
      summary: Update schedule
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ScheduleId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScheduleUpdateRequest"
      responses:
        "200":
          description: Updated schedule
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Schedule"
        "404":
          description: Not Found
    delete:
      summary: Deactivate schedule
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ScheduleId"
      responses:
        "200":
          description: Deactivated schedule
        "404":
          description: Not Found
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
  parameters:
    MedicationId:
      name: medication
      in: path
      required: true
      schema:
        type: integer
    ScheduleId:
      name: schedule
      in: path
      required: true
      schema:
        type: integer
    IncludeInactive:
      name: include_inactive
      in: query
      required: false
      schema:
        type: boolean
  schemas:
    TokenResponse:
      type: object
      properties:
        token:
          type: string
    RegisterRequest:
      type: object
      required: [name, email, password]
      properties:
        name:
          type: string
        email:
          type: string
        password:
          type: string
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
        password:
          type: string
    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
        timezone:
          type: string
          nullable: true
        language:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    UserProfileUpdateRequest:
      type: object
      required: [timezone, language]
      properties:
        timezone:
          type: string
        language:
          type: string
          enum: [en, pt-BR]
    Medication:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        name:
          type: string
        dosage:
          type: string
        instructions:
          type: string
          nullable: true
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    MedicationCreateRequest:
      type: object
      required: [name, dosage]
      properties:
        name:
          type: string
        dosage:
          type: string
        instructions:
          type: string
          nullable: true
        is_active:
          type: boolean
    MedicationUpdateRequest:
      type: object
      properties:
        name:
          type: string
        dosage:
          type: string
        instructions:
          type: string
          nullable: true
        is_active:
          type: boolean
    Schedule:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        medication_id:
          type: integer
        type:
          type: string
          enum: [daily, weekly, interval]
        payload:
          type: object
        starts_at:
          type: string
          format: date-time
          nullable: true
        ends_at:
          type: string
          format: date-time
          nullable: true
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ScheduleCreateRequest:
      type: object
      required: [medication_id, type, payload]
      properties:
        medication_id:
          type: integer
        type:
          type: string
          enum: [daily, weekly, interval]
        payload:
          type: object
        starts_at:
          type: string
          format: date-time
          nullable: true
        ends_at:
          type: string
          format: date-time
          nullable: true
        is_active:
          type: boolean
    ScheduleUpdateRequest:
      type: object
      properties:
        type:
          type: string
          enum: [daily, weekly, interval]
        payload:
          type: object
        starts_at:
          type: string
          format: date-time
          nullable: true
        ends_at:
          type: string
          format: date-time
          nullable: true
        is_active:
          type: boolean
